---
title: "Practical 1 - Bayes rule"
author: "Spatial and Spatio-Temporal Bayesian Models with `R-INLA`"
output: 
  html_document:
    css: practical.css
    toc: true
    toc_float: true
---

\pagenumbering{gobble} 
\pagenumbering{arabic} 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE, fig.align = "center", class.source='klippy')
```
```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy(position = c('top', 'right'),color = 'darkred',
               tooltip_message = 'Click to copy', tooltip_success = 'Done')
```

# 1. Comparing between the prior (unconditional) and the posterior (conditional)

For each scenario below, you are given a pair of events, $A$ and $B$. Explain what you believe to be the relationships between the prior and posterior probabilities of $B$. For example, $P(B|A) < P(B)$.


  a. $A$ is *you live in a house with someone who has COVID-19* and $B$ is *you become ill with COVID-19*

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) > P(B)$
::::

  b. $A$ is *you wear a mask in areas with poor ventilation* and $B$ is *you become ill with COVID-19*

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) < P(B)$
::::

  c. $A$ is *you attend a cervical cancer screening and have the HPV vaccine* and $B$ is *you contract cervical cancer*

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) < P(B)$
::::

  d. $A$ is *you regularly smoke cigarettes* and $B$ is *you contract cervical cancer*

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) > P(B)$
::::

  e. $A$ is *socially distance when you have flu-like symptoms* and $B$ is *you contract cervical cancer*

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) = P(B)$
::::


# 2. Probabilities

Consider the following events: $A$ is *going to an underground bar*, $B$ is *testing positive for COVID-19* and, $C$ is *having COVID-19*. Write down the following statements in probabilistic notation.

  a. $47\%$ of people that go to an underground bar get COVID-19
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|A) = 47\%$
::::
  
  
  b. If you have COVID-19, you have an $86\%$ chance of a positive COVID-19 test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B|C) = 86\%$
::::  
  
  c. $39\%$ of the population have COVID-19

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(C) = 39\%$
::::
  
  d. If you do not have COVID-19, you have an $4\%$ chance of a negative COVID-19 test

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B^c|C^c) = 4\%$
::::
  
  
  e. All your friends have said they would go to the underground bar if they have a negative COVID-19 test

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A|B^c) = 100\%$
::::
  
  f. $1\%$ of people go to an underground bar and have a positive COVID-19 test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A \cap B) = 1\%$
::::
  

# 3. Cervical cancer example

The prevalence of cervical cancer in a population is $8\%$. A pap smear test is used to identify those who have cervical cancer and is known to be $57\%$ sensitive and $76\%$ specific. In the following, let $A$ be the event *an individual has cervical cancer* and $B$ be the event *an individual tests positive to having cervical cancer on the pap smear test*. 
Using the information above, answer the following:

  a. What are the probabilities that an individual has and has not got cervical cancer?

<!-- --- -->
<!-- **HINT**: this is the true positive rate -->
<!-- --- -->

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$$
\begin{aligned}
P(A) & = 0.08 \\
P(A^c) & = 1 - 0.08 = 0.92
\end{aligned}
$$
::::

  b. What are the probabilities that an individual returns a positive pap smear test **given** they have cervical cancer and that an individual returns a negative pap smear test **given** they do not have cervical cancer?
  
<!-- --- -->
<!-- **HINT**: this is the true negative rate -->
<!-- --- -->
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$$
\begin{aligned}
P(B|A) & = 0.57 \\
P(B^c | A^c) & = 0.76
\end{aligned}
$$
::::

  c. Consider the following table
  
```{r, echo = FALSE}
library(tidyverse)
data.frame(Event = c('$A$', '$A^c$', '$Total$'), B1 = c('', '', ''), B2 = c('', '' , ''), Total = c('', '', 1)) %>%
  kableExtra::kable(., align = 'cccc', col.names = c('$Event$', '$B$', '$B^c$', '$Total$'))  %>%
  kableExtra::column_spec(1:4, border_left = T, border_right = T) %>% 
  kableExtra::kable_styling()
```

  using your answers from the part a and b , calculate the following:
  
  i. The probability an individual has cervical cancer **and** returns a positive pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A \cap B) = P(A)P(B|A) = 0.08 \times 0.57 = 0.0456$
::::
  
  ii. The probability an individual has cervical cancer **and** returns a negative pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A \cap B^c) = P(A)P(B^c|A) = 0.08 \times [1 - 0.57] = 0.0344$
::::
  
  iii. The probability an individual does not have cervical cancer **and** returns a positive pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A^c \cap B) = P(A^c)P(B|A^c) = [1-0.08] \times [1 - 0.76] = 0.2208$
::::  
  
  iv. The probability an individual does not have cervical cancer **and** returns a negative pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(A^c \cap B^c) = P(A^c)P(B^c|A^c) = [1-0.08] \times 0.76 = 0.6992$
::::
  
  v. The probability an individual returns a negative pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B^c) = P(A \cap B^c) + P(A^c \cap B^c) = 0.0344 + 0.6992 = 0.7336$
::::
  
  vi. The probability an individual returns a positive pap smear test
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
$P(B) = P(A \cap B) + P(A^c \cap B) = 0.0456 + 0.0344 = 0.2664$
::::

  vii. Complete the table

:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
```{r, echo = FALSE}
library(tidyverse)
data.frame(Event = c('$A$', '$A^c$', '$Total$'), B = c(0.0456, 0.2208, 0.2664), B2 = c(0.0344, 0.6992 , 0.7336), Total = c(0.08, 0.92, 1)) %>%
  kableExtra::kable(., align = 'cccc', col.names = c('$Event$', '$B$', '$B^c$', '$Total$'))  %>%
  kableExtra::column_spec (1:4, border_left = T, border_right = T) %>% 
  kableExtra::kable_styling()
```
::::

 viii. Finally return the probability that an individual has cervical cancer given that they test positive on the pap smear.
 
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
We can get this it two ways: 
1) using the table from point vii and noting that
$$P(A | B) = P(A \cap B) / P(B) = 0.0456 / 0.2664 = 0.1711$$

2) Using Bayes' theorem:
$$P(A | B) = \frac{P(B | A)P(A)}{P(B | A)P(A)+P(B | A^C)P(A^C)}=\frac{0.57 \times 0.08}{0.57 \times 0.08 + 0.24 \times 0.92}=0.1711$$
::::

# 4. New screening method

An alternative screening method for cervical cancer is to use a colposcopy which is know to be $92\%$ and $67\%$ sensitive and specific. 

  a. Using the same prevalence as in Question 2, obtain the probability of having cervical cancer if you test positive at the colposcopy. Compare the pros and cons of the two different screening methods.
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
```{r, echo = FALSE}
library(tidyverse)
data.frame(Event = c('$A$', '$A^c$', '$Total$'), B = c(0.0736, 0.3036, 0.3772), B2 = c(0.0064, 0.6164 , 0.6228), Total = c(0.08, 0.92, 1)) %>%
  kableExtra::kable(., align = 'cccc', col.names = c('$Event$', '$B$', '$B^c$', '$Total$'))  %>%
  kableExtra::column_spec (1:4, border_left = T, border_right = T) %>% 
  kableExtra::kable_styling()
```

We now get 
$$P(A | B) = 0.0736 / 0.3772 = 0.1951$$
::::


  b. What does it mean for a test to be highly sensitive?
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
Sensitivity refers to a test's ability to detect an individual with disease as positive. Therefore, a highly sensitive test means that there are few false negative results, and thus fewer cases of disease are missed.
::::
  
  
  c. What does it mean for a test to be highly specific?
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
Specificity refers to a test's ability to detect an individual with disease as negative Therefore, a highly specific test means that there are few false positive results, and thus fewer cases of disease are treated when they should not be. This is important for potentially intrusive treatment procedures. 
::::
  
  
  d. Given the two screening methods in Questions 3 and 4, what is the best method of screening for cervical cancer? You can use, none, either, or both.
  
:::: {.blackbox data-latex=""}
::: {.center data-latex=""}
**Solution**
:::
A pap smear is less sensitive, but more specific than the colposcopy. The  probability of having cervical cancer given a positive smear is only slightly smaller than given a positive colposcopy. This along with a pap smear being less intrusive than a colposcopy, would be than using a pap smear as an initial diagnosis and then the colposcopy as a confirmation would be a good overall method for screening for cervical cancer. 
::::
