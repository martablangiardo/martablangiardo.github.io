<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Session 1.2: Bayes Theorem</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link rel="stylesheet" href="../assets/beamer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">




class: title-slide

# Session 1.2: Bayes Theorem&lt;span style="display:block; margin-top: 10px ;"&gt;&lt;/span&gt; 

## 

###     

### Imperial College London 

&lt;!-- Can also separate the various components of the extra argument 'params', eg as in 
### Imperial College London, , MSc in Epidemiology / Health Data Analytics
--&gt;










---

layout: true  

.my-footer[ 
.alignleft[ 
&amp;nbsp; &amp;copy; Marta Blangiardo | Monica Pirani 
]
.aligncenter[
MSc in Epidemiology / Health Data Analytics 
]
.alignright[
Imperial College London, NA 
]
] 


&lt;style&gt;
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
&lt;/style&gt;


---

# Learning objectives

After this lecture you should be able to 
&lt;span style="display:block; margin-top: 40px ;"&gt;&lt;/span&gt;
- Distinguish between conditional probability and likelihood      
&lt;span style="display:block; margin-top: 40px ;"&gt;&lt;/span&gt;
- Compute joint and conditional probabilities
&lt;span style="display:block; margin-top: 40px ;"&gt;&lt;/span&gt;
- Use Bayes theorem to obtain posterior probabilities

&lt;span style="display:block; margin-top: 20px ;"&gt;&lt;/span&gt;

The topics treated in this lecture are presented in Chapter 3  of Blangiardo and Cameletti (2015) and in Chapter 2 of  Johnson, Ott, and Dogucu (2022).

---

# Outline 

&lt;span style="display:block; margin-top: 30px ;"&gt;&lt;/span&gt;

1\. [Conditional probability and likelihood](#Cond_lik)

&lt;span style="display:block; margin-top: 30px ;"&gt;&lt;/span&gt;

2\. [Normalising constant](#Norm)

&lt;span style="display:block; margin-top: 30px ;"&gt;&lt;/span&gt;

3\. [Bayes Theorem](#BayTheo)

---

name: Cond_lik
  
&lt;span style="display:block; margin-top: 250px ;"&gt;&lt;/span&gt;

.myblue[.center[.huge[
**Conditional probability and likelihood**]]]

---

# Example: COVID-19 test

- A COVID-19 test has shown to have 80% sensitivity and 99% specificity 

- In England, COVID-19 prevalence is 6%
&lt;span style="display:block; margin-top: 50px ;"&gt;&lt;/span&gt;

&lt;center&gt;
.content-box-green[What is the chance that a patient testing positive actually does have COVID-19?]
&lt;/center&gt;

&lt;span style="display:block; margin-top: 100px ;"&gt;&lt;/span&gt;


--
We have two pieces of information:

1. Our prior suggests that the COVID-19 prevalence in the country is low (6%)
2. Our data suggest that our diagnostic test is accurate
---

# Example: COVID-19 test

How can we balance these two pieces of information to answer the question about having the disease?

&lt;span style="display:block; margin-top: 50px ;"&gt;&lt;/span&gt;

&lt;center&gt;&lt;img src=./img/Doodle.png width='75%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

---

# Prior probability model

- Let's look at our prior: COVID-19 prevalence in the country is 6%. How can we formalise it?
&lt;span style="display:block; margin-top: 50px ;"&gt;&lt;/span&gt;

Define A as the event: **a person has COVID-19 in England**

Then `\(P(A)=0.06\)` and consequently `\(P(A^C)=0.94\)`.
&lt;span style="display:block; margin-top: 50px ;"&gt;&lt;/span&gt;

Remember that a valid probability model must: 
1. account for all possible events (having or not having COVID-19); 
2. assign prior probabilities to each event.

&lt;span style="display:block; margin-top: 20px ;"&gt;&lt;/span&gt;

Also 
3. each probability must be between 0 and 1;
4. these probabilities must sum to one.

---


# Conditional probability 

Now we summarise the **data** that we get from the diagnostic tests:

- 80% sensitivity: if a person has COVID-19 they will test positive 80 out of 100 times

- 99% specificity: if a person does not have COVID-19 they will test negative 99 out of 100 times 

--

These are .alert[**conditional probabilities**] and defining B the event: a person tests positive for COVID-19, we can summarise the above information in  

`$$P(B \mid A) = 0.8$$`
and
`$$P(B \mid A^C) = 1 - P(B^C \mid A^C) = 1 - 0.99 =0.01$$`

---

# Some rules of conditional probabilities

In general, comparing the conditional vs unconditional probabilities `\(P(B\mid A)\)` vs `\(P(B)\)`, reveals the extent to which information about `\(B\)` changes in light of `\(A\)` 

In some cases, the certainty of an event `\(B\)` might increase in light of new data `\(A\)`: 

- if you eat hamburgers and chips every day, your probability of having high colesterol is higher than in the general population

`$$P(B \mid A) &gt; P(B)$$`

--

In some cases, the certainty of an event `\(B\)` might decrease in light of new data `\(A\)`: 

- if you are vaccinated against flu, your probability of getting into hospital with serious flu complications decreases

`$$P(B \mid A) &lt; P(B)$$`
--

The order of conditioning is also important, as generally `\(P(B \mid A) \neq P(A \mid B)\)`: for instance in India the probability of getting bitten by a snake after a week of torrential rain is `\(P(B \mid A)=0.4\)`; but this does not mean that there is a 0.4 probability of a week of torrential rain after someone is bitten by a snake `\(P(A \mid B)\)`. 

--

Finally information about A does not always change our understanding of B: then the two events are **independent** and `\(P(B \mid A) = P(B)\)`
&lt;span style="display:block; margin-top: 20px ;"&gt;&lt;/span&gt;

--

.red[See recording 2 for an additional recap on Probability]

---

# Some rules of conditional probabilities

- Provable from probability axioms



$$ P(A|B) =\frac{P(A \cap B)}{P(B)} = \frac{ P(B|A) P(A) } {P(B)}$$

&lt;span style="display:block; margin-top: -20px ;"&gt;&lt;/span&gt;

&lt;center&gt;&lt;img src=./img/venn_diagram.png width='50%' title=''&gt;&lt;/center&gt;

&lt;span style="display:block; margin-top: -20px ;"&gt;&lt;/span&gt;

- If `\(A_i\)` is a set of mutually exclusive and exhaustive events
(*i.e.* `\(A_i\cap A_j=\emptyset\)`, `\(P( \bigcup\limits_i A_i ) = \sum\limits_i P(A_i) = 1\)`), then

$$ P(A_i|B) = \frac{ P(B|A_i) P(A_i) } {P(B)} = \frac{ P(B|A_i) P(A_i) } {\sum\limits_j P(B|A_j) P(A_j) }$$

---

# Likelihood

Let's re-examine the COVID-19 example: we know that if someone has the disease their probability of testing positive is much higher than if they do not (0.8 vs 0.01), so what we think is that the probability of having the disease if testing positive must be high. 

We are moving unconsciously from conditional probability to likelihood.

--

When A is known, the conditional probability function `\(P(.\mid A)\)` allows to compute the probabilities of an unknown event `\(B\)` or `\(B^C\)`:
`$$P(B\mid A) \text{ compared to } P(B^C \mid A)$$`
When B is known (i.e. observed), the likelihood function `\(L(.\mid B)\)` allows to evaluate the relative compatibility of the data `\(B\)` with the event `\(A\)` or `\(A^C\)`:

`$$L(A \mid B) = P(B \mid A) \text{   compared to   } L(A^C \mid B) = P(B \mid A^C)$$`

--

So far we have (i) the prior evidence of getting COVID-19 and (ii) the likelihood which tells that a positive test is more likely among diseased people:


Table: Prior probability and likelihood

|Event      |    A|  A^C| Total|
|:----------|----:|----:|-----:|
|Prior      | 0.06| 0.94|  1.00|
|Likelihood | 0.80| 0.01|  0.81|
---

name: Norm
  
&lt;span style="display:block; margin-top: 250px ;"&gt;&lt;/span&gt;

.myblue[.center[.huge[
**Normalising constant**]]]

---

# Normalising constant

The marginal probability of testing positive `\(P(B)\)` provides an important point of comparison. This is the last bit of information we need. Let's try to fill in the table below:

&lt;center&gt;&lt;img src=./img/Table_Prob.png width='50%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

First let's look at the row A: there are those who tests positive AND have the disease and those who do not test positive AND have the disease. To get these probabilities remember that `\(P(A)=0.06\)` and that `\(P(B\mid A)=0.8\)`, so that 

1. `\(P(A \cap B) = 0.06 \times 0.8 = 0.048\)`
Then using a similar rationale we can get:
2. `\(P(A \cap B^C) = P(B^C\mid A) \times P(A) = (1-0.8)\times 0.06 = 0.012\)`
3. `\(P(A^C\cap B) = P(B\mid A^C) \times P(A^C) = 0.01\times 0.94 = 0.009\)`
4. `\(P(A^C \cap B^C) = P(B^C\mid A^C) \times P(A^C) = 0.99 \times 0.94 = 1- 0.048 - 0.012 - 0.0094 = 0.931\)`

And finally the `\(P(B) = 0.048 + 0.0094 = 0.057\)`
---

count: false

# Normalising constant

The marginal probability of testing positive `\(P(B)\)` provides an important point of comparison. This is the last bit of information we need. Let's try to fill in the table below:

&lt;center&gt;&lt;img src=./img/Table_Bay2.png width='50%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

First let's look at the row A: there are those who tests positive AND have the disease and those who do not test positive AND have the disease. To get these probabilities remember that `\(P(A)=0.06\)` and that `\(P(B\mid A)=0.8\)`, so that 

1. `\(P(A \cap B) = 0.06 \times 0.8 = 0.048\)`
Then using a similar rationale we can get:
2. `\(P(A \cap B^C) = P(B^C\mid A) \times P(A) = (1-0.8)\times 0.06 = 0.012\)`
3. `\(P(A^C\cap B) = P(B\mid A^C) \times P(A^C) = 0.01\times 0.94 = 0.009\)`
4. `\(P(A^C \cap B^C) = P(B^C\mid A^C) \times P(A^C) = 0.99 \times 0.94 = 1- 0.048 - 0.012 - 0.0094 = 0.931\)`

And finally the `\(P(B) = 0.048 + 0.0094 = 0.057\)`
---

name: BayTheo
  
&lt;span style="display:block; margin-top: 250px ;"&gt;&lt;/span&gt;

.myblue[.center[.huge[
**Bayes Theorem**]]]

---

# Now we put all together...

We are now ready to answer the question: 
&lt;span style="display:block; margin-top: 10px ;"&gt;&lt;/span&gt;

&lt;center&gt;
.content-box-green[What is the chance that a patient testing positive actually does have COVID-19?]
&lt;/center&gt;

&lt;span style="display:block; margin-top: 10px ;"&gt;&lt;/span&gt;

Going back to the table we can zoom in into the people testing positive  

&lt;center&gt;&lt;img src=./img/Table_Bay3.png width='40%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

and using the conditional probability rules we get 
`$$P(A \mid B) = \frac{P(A \cap B)}{P(B)} = 0.048 / 0.057 = 0.84$$`


&lt;center&gt;.red[**This is building Bayes Theorem from scratch.**]&lt;/center&gt;


Now remember that 
`$$P(A \cap B) = P(B \mid A) P(A)$$`

then Bayes' theorem will calculate `\(P(A \mid B)\)` combining information from the prior `\(P(A)\)` and the likelihood of observing `\(A\)` with the event `\(B\)`, given by `\(P(B \mid A)\)`

---

# Does it really work?

&lt;span style="display:block; margin-top: -10px ;"&gt;&lt;/span&gt;

&lt;center&gt;&lt;img src=./img/example_as_bayes_no_values.png width='75%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

--

&lt;span style="display:block; margin-top: -20px ;"&gt;&lt;/span&gt;

Using Bayes' theorem we get

`$$p(A|B) = \frac{ P(B|A) P(A) } {P(B|A) P(A) + P(B|A^C) P(A^C)}$$`

---
count:false

# Does it really work?

&lt;span style="display:block; margin-top: -10px ;"&gt;&lt;/span&gt;

&lt;center&gt;&lt;img src=./img/example_as_bayes_values.png width='75%' title='INCLUDE TEXT HERE'&gt;&lt;/center&gt;

--

&lt;span style="display:block; margin-top: -20px ;"&gt;&lt;/span&gt;

Using Bayes' theorem we get

`$$p(A|B) = \frac{ P(B|A) P(A) } {P(B|A) P(A) + P(B|A^C) P(A^C)}=\frac{0.8 \times 0.06 } {0.8 \times  0.06 + 0.01 \times 0.94} = 0.84$$`

---

# Comments

.pull-left[

- The disease prevalence can be thought of as a *prior* probability ( `\(p\)` = 0.06)

&lt;span style="display:block; margin-top: 20px ;"&gt;&lt;/span&gt;

- Observing a positive result causes us to modify this probability to `\(p\)` = 0.84. This is our *posterior* probability that patient is COVID-19 positive.

]

.pull-right[

&lt;center&gt;&lt;img src=./img/Bayes1.png width='150%' title=''&gt;&lt;/center&gt;
]

--

- Bayes theorem applied to *observables* (as in diagnostic testing) is uncontroversial and established
- More controversial in general statistical analyses: *parameters* are unknown quantities, and prior distributions need to be specified `\(\rightarrow\)` .red[Bayesian inference]

- Stay tuned, we are going to dive into that next week!
---

# References

Blangiardo, M. and M. Cameletti (2015). _Spatial and spatio-temporal
Bayesian models with R-INLA_. John Wiley &amp; Sons.

Johnson, A. A., M. Q. Ott, and M. Dogucu (2022). _Bayes Rules!: An
Introduction to Applied Bayesian Modeling_. CRC Press.
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="https://platform.twitter.com/widgets.js"></script>
<script>var slideshow = remark.create({
"navigation": {
"scroll": false
},
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
